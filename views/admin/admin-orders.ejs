<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Orders - LunaLoom</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="/css/admin-orders.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>

  <!-- Sidebar -->
  <%- include('../partials/adminSidebar', { activePage: 'orders' }) %>

  <div class="main-content">
    <div class="page-title">Orders</div>

    <% if (success) { %>
      <div class="alert success"><%= success %></div>
    <% } %>

    <% if (error) { %>
      <div class="alert error"><%= error %></div>
    <% } %>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Product</th>
            <th>Customer</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Order Date</th>
            <th>Payment</th>
            <th>Update Status</th>
            <th>Delivered</th>
          </tr>
        </thead>

        <tbody>
          <% orders.forEach(order => { %>
            <tr>
              <!-- Order ID -->
              <td><%= order._id %></td>

              <!-- Products -->
              <td>
                <% order.items.forEach(item => { %>
                  <div><%= item.product?.name %></div>
                <% }) %>
              </td>

              <!-- Customer -->
              <td><%= order.userId?.name || "N/A" %></td>

              <!-- Quantity -->
              <td>
                <%= order.items.reduce((sum, item) => sum + item.quantity, 0) %>
              </td>

              <!-- Total -->
              <td>₹ <%= order.totalAmount %></td>

              <!-- Date -->
              <td>
                <%= new Date(order.createdAt).toLocaleDateString('en-IN') %>
              </td>

              <!-- Payment -->
              <td><%= order.paymentMethod %></td>

              <!-- UPDATE STATUS -->
              <td>
                <form action="/admin-orders/update/<%= order._id %>" method="POST">
                  <select name="orderStatus"
                    <%= order.orderStatus === 'Delivered' ? 'disabled' : '' %>
                    required>
                    
                    <option value="Placed" <%= order.orderStatus === 'Placed' ? 'selected' : '' %>>
                      Placed
                    </option>
                    <option value="Shipped" <%= order.orderStatus === 'Shipped' ? 'selected' : '' %>>
                      Shipped
                    </option>
                    <option value="Delivered" <%= order.orderStatus === 'Delivered' ? 'selected' : '' %>>
                      Delivered
                    </option>
                    <option value="Cancelled" <%= order.orderStatus === 'Cancelled' ? 'selected' : '' %>>
                      Cancelled
                    </option>
                  </select>

                  <% if(order.orderStatus !== 'Delivered'){ %>
                    <button class="btn btn-update" type="submit">
                      Update
                    </button>
                  <% } %>
                </form>
              </td>

              <!-- DELIVERED CHECK -->
              <td>
                <% if(order.orderStatus === 'Delivered'){ %>
                  ✔
                <% } else { %>
                  ❌
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>

      </table>
    </div>
  </div>

</body>
</html>

