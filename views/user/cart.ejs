<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="icon" href="/img/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Animation and carousel -->
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">

    <!-- Font Awesome & Icons -->
    <link rel="stylesheet" href="/css/all.css">
    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/themify-icons.css">

    <!-- Popup & Slider -->
    <link rel="stylesheet" href="/css/magnific-popup.css">
    <link rel="stylesheet" href="/css/slick.css">

    <!-- Shared and page-specific CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/cart.css">
</head>
<body>
    <!-- views/user/cart.ejs -->

<%- include('../partials/header') %>

<!-- dynamic alert messages -->
<% if (success) { %>
  <div class="alert alert-success text-center" role="alert">
    <%= successMessage %>
  </div>
<% } %>

<% if (error) { %>
  <div class="alert alert-danger text-center" role="alert">
    <%= errorMessage %>
  </div>
<% } %>

<!-- breadcrumb part start-->
<section class="breadcrumb_part">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="breadcrumb_iner">
          <h2>Cart List</h2>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- breadcrumb part end-->

<!--================Cart Area =================-->
<section class="cart_area section_padding">
  <div class="container">
    <div class="cart_inner">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Product</th>
              <th scope="col">Price</th>
              <th scope="col">Quantity</th>
              <th scope="col">Total</th>
              <th scope="col">Actions</th>
              
            
              
            </tr>
          </thead>

          <tbody>
  <% if (cart && cart.products.length > 0) { %>

    <% cart.
    products.forEach(item => { %>
      <tr>
        <td>
          <div class="media">
            <div class="d-flex">

              <img 
                src="<%= item.productId.images && item.productId.images.length > 0 
                        ? item.productId.images[0] 
                        : 'img/default.png' %>" 
                alt="<%= item.productId.title %>" 
                style="width: 80px; height: 80px; object-fit: cover;"
              >

            </div>

            <div class="media-body">
              <p><%= item.productId.title %></p>
            </div>
          </div>
        </td>

        <td>
          <h5>₹<%= item.productId.price.toFixed(2) %></h5>
        </td>

        <td>
          <div class="product_count">

            <a href="/cart/decrease/<%= item.productId._id %>" class="input-number-decrement">
              <i class="ti-minus"></i>
            </a>

            <input class="input-number" type="text" 
                   value="<%= item.quantity %>" min="1" max="100">

            <a href="/cart/increase/<%= item.productId._id %>" class="input-number-increment">
              <i class="ti-plus"></i>
            </a>

          </div>
        </td>

        <td>
          <h5>₹<%= (item.productId.price * item.quantity).toFixed(2) %></h5>
        </td>

        <td>
         

          <a href="/cart/remove/<%= item.productId._id %>"
              class="btn btn-danger btn-sm delete-btn"
                title="Delete">
                <i class="fa fa-trash"></i>
          </a>

        </td>

      </tr>
    <% }) %>

    <!-- Subtotal -->
    <tr>
      <td></td>
      <td></td>
      <td><h5>Subtotal</h5></td>
      <td><h5>₹<%= total.toFixed(2) %></h5></td>
      <td></td>
    </tr>

  <% } else { %>

    <tr>
      <td colspan="5" class="text-center py-5">Your cart is empty.</td>
    </tr>

  <% } %>
</tbody>

        </table>

        <% if (cart.products.length > 0) { %>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="/product_list">Continue Shopping</a>
            <a class="btn_1 checkout_btn_1" href="/checkout">Proceed to checkout</a>
          </div>
        <% } %>

      </div>
    </div>
  </div>
</section>
<!--================End Cart Area =================-->

<%- include('../partials/footer') %>
<div id="confirmPopup" class="confirm-popup">
  <div class="popup-box">
    <p>Are you sure you want to delete this product?</p>

    <div class="popup-buttons">
      <button id="confirmYes">Yes</button>
      <button id="confirmNo">No</button>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const deleteButtons = document.querySelectorAll(".delete-btn");
  const popup = document.getElementById("confirmPopup");
  const yesBtn = document.getElementById("confirmYes");
  const noBtn = document.getElementById("confirmNo");

  let targetHref = null;

  deleteButtons.forEach(btn => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();  
      targetHref = this.getAttribute("href"); 
      popup.classList.add("show");
    });
  });

  yesBtn.addEventListener("click", function () {
    popup.classList.remove("show");
    if (targetHref) {
      window.location.href = targetHref;
    }
  });

  noBtn.addEventListener("click", function () {
    popup.classList.remove("show");
    targetHref = null;
  });
});
</script>



</body>
</html>