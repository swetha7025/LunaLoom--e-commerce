<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <link rel="icon" href="/img/LL.png">
  <link rel="stylesheet" href="/css/checkout.css">
   <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">

  <!-- Animation and carousel -->
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/css/owl.carousel.min.css">

  <!-- Font Awesome & Icons -->
  <link rel="stylesheet" href="/css/all.css">
  <link rel="stylesheet" href="/css/flaticon.css">
  <link rel="stylesheet" href="/css/themify-icons.css">

  <!-- Popup & Slider -->
  <link rel="stylesheet" href="/css/magnific-popup.css">
  <link rel="stylesheet" href="/css/slick.css">

  <!-- Shared and page-specific CSS -->
  <link rel="stylesheet" href="/css/style.css"> <!-- main site styles (home, header, etc.) -->
  <link rel="stylesheet" href="/css/header.css"> <!-- header/navbar styles -->
  <link rel="stylesheet" href="/css/footer.css">
</head>
<body>

<!-- HEADER -->

<%- include('../partials/header') %>


  <section class="breadcrumb_part">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="breadcrumb_iner">
            <h2>Checkout</h2>
          </div>
        </div>
      </div>
    </div>
  </section>


<!-- MESSAGES -->
<div class="container">
  <% if (success) { %>
    <div class="alert success"><%= success %></div>
  <% } %>

  <% if (error) { %>
    <div class="alert error"><%= error %></div>
  <% } %>
</div>

<!-- CHECKOUT -->
<div class="container checkout-wrapper">

  <!-- LEFT -->
  <form action="/place-order" method="POST" class="checkout-left">

    <input type="hidden" name="couponCode" id="appliedCoupon">
<input type="hidden" name="discount" id="appliedDiscount">
<input type="hidden" name="finalAmount" id="finalAmountInput">


    <!-- DELIVERY ADDRESS -->
    <div class="card">
      <h3>Delivery Address</h3>

      <label>Select Saved Address</label>
      <select name="addressId" required>
        <% addresses.forEach(address => { %>
          <option value="<%= address._id %>">
            <%= address.label %> - <%= address.city %>, <%= address.pincode %>
          </option>
        <% }) %>
      </select>

      <a href="/address" class="edit-address">➕ Add / Edit Address</a>
    </div>

    <!-- CONTACT DETAILS -->
    <div class="card">
      <h3>Contact Details</h3>

      <div class="grid-2">
        <div>
          <label>Full Name</label>
          <input type="text" name="name" value="<%= user.name %>" required>
        </div>

        <div>
          <label>Email</label>
          <input type="email" name="email" value="<%= user.email %>" required>
        </div>

        <div>
          <label>Phone Number</label>
        <input
        type="text"
         name="phone"
        value="<%= addresses[0]?.phone || '' %>"
        required
        >

        </div>

        <div>
          <label>Alternate Phone (Optional)</label>
          <input type="text" name="altPhone">
        </div>
      </div>
    </div>

    <!-- PAYMENT -->
    <div class="card">
      <h3>Payment Method</h3>

      <select name="paymentMethod" required>
        <option value="COD">Cash on Delivery</option>
        <option value="ONLINE">Online Payment</option>
      </select>

      <label>Delivery Instructions (Optional)</label>
      <textarea name="instructions" placeholder="E.g. Leave package at the door"></textarea>

      <button type="submit" class="btn">Proceed to Payment</button>
    </div>

  </form>

 
 <!-- RIGHT -->
<div class="checkout-right card">
  <h3>Order Summary</h3>

  <% cartItems.forEach(item => { %>
    <div class="summary-row">
      <span><%= item.product.name %> (x<%= item.quantity %>)</span>
      <span>₹<%= item.total.toFixed(2) %></span>
    </div>
  <% }) %>

  <hr>

  <!-- DISCOUNT -->
  <% if (discountAmount > 0) { %>
    <div class="summary-row text-success">
      <span>
        Discount
        <% if (appliedCoupon) { %>
          (<%= appliedCoupon %>)
        <% } %>
      </span>
      <span>- ₹<%= discountAmount.toFixed(2) %></span>
    </div>
  <% } %>

  <div class="summary-row total">
    <span>Total</span>
    <span>₹<%= total.toFixed(2) %></span>
  </div>
</div>



</div>

<%- include('../partials/footer') %>

</body>
</html>
